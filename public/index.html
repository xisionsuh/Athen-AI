<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Athena AI - Multi-Agent Collaborative System</title>
  <meta name="description" content="Multi-AI collaborative system with brain-like architecture">
  <meta name="theme-color" content="#667eea">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/styles.css">
  <!-- Prism.js for code highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <!-- Chart.js for performance charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="app-container">
    <!-- 사이드바 -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>🧠 Athena</h1>
        <p class="subtitle">Multi-AI Brain</p>
        <p class="user-info" id="userInfo" style="font-size: 0.8rem; color: #b8b8d4; margin-top: 0.5rem;">
          <span id="currentUser"></span>
        </p>
      </div>

      <button class="new-chat-btn" id="newChatBtn">
        <span>➕</span> 새 대화
      </button>

      <!-- 프로젝트 섹션 -->
      <div class="sidebar-section">
        <div class="sidebar-section-header">
          <h3>📁 프로젝트</h3>
          <button class="icon-btn-small" id="newProjectBtn" title="새 프로젝트">➕</button>
        </div>
        <div class="projects-list" id="sidebarProjectsList">
          <!-- 프로젝트 목록이 여기에 동적으로 추가됩니다 -->
        </div>
      </div>

      <!-- 세션 섹션 -->
      <div class="sidebar-section">
        <div class="sidebar-section-header">
          <h3>💬 대화</h3>
        </div>
        <div class="sessions-list" id="sessionsList">
          <!-- 세션 목록이 여기에 동적으로 추가됩니다 -->
        </div>
      </div>

      <div class="sidebar-footer">
        <div class="ai-status" id="aiStatus">
          <div class="status-title">Meta AI (총괄 AI) 계층</div>
          <div class="status-indicators">
            <div class="status-item">
              <span class="status-dot" id="gptStatus"></span>
              <span>🧠 ChatGPT</span>
            </div>
            <div class="status-item">
              <span class="status-dot" id="geminiStatus"></span>
              <span>🥈 Gemini</span>
            </div>
            <div class="status-item">
              <span class="status-dot" id="claudeStatus"></span>
              <span>🥉 Claude</span>
            </div>
            <div class="status-item">
              <span class="status-dot" id="grokStatus"></span>
              <span>🏅 Grok</span>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- 메인 채팅 영역 -->
    <main class="main-content">
      <div class="chat-header">
        <h2 id="chatTitle">새 대화</h2>
        <div class="header-actions">
          <button class="icon-btn" id="voiceSettingsBtn" title="음성 설정">
            🎙️
          </button>
          <button class="icon-btn" id="voiceConversationBtn" title="실시간 음성 대화 모드">
            🗣️
          </button>
          <button class="icon-btn" id="ttsToggle" title="음성 출력 (TTS) 켜기/끄기">
            🔊
          </button>
          <button class="icon-btn" id="ttsPauseBtn" title="음성 출력 일시정지/재개" style="display: none;">
            ⏸️
          </button>
          <button class="icon-btn" id="themeToggle" title="다크/라이트 모드 전환">
            🌙
          </button>
          <button class="icon-btn" id="performanceBtn" title="성능 대시보드">
            📊
          </button>
          <button class="icon-btn" id="learningBtn" title="학습 결과 시각화">
            📈
          </button>
          <button class="icon-btn" id="browserControlBtn" title="웹 브라우저 제어">
            🌐
          </button>
          <button class="icon-btn" id="memoryBtn" title="장기 기억 관리">
            📚
          </button>
          <button class="icon-btn" id="projectBtn" title="프로젝트 관리">
            📁
          </button>
          <button class="icon-btn" id="logoutBtn" title="로그아웃" onclick="logout()">
            🚪
          </button>
        </div>
      </div>

      <div class="chat-messages" id="chatMessages">
        <div class="welcome-screen">
          <div class="welcome-icon">🧠</div>
          <h2>Athena에 오신 것을 환영합니다</h2>
          <p>여러 AI가 협업하여 최선의 답변을 제공하는 지능형 비서입니다.</p>
          <div class="features">
            <div class="feature">
              <span class="feature-icon">🤝</span>
              <span>다중 AI 협업</span>
            </div>
            <div class="feature">
              <span class="feature-icon">🔍</span>
              <span>웹 검색 통합</span>
            </div>
            <div class="feature">
              <span class="feature-icon">🧠</span>
              <span>맥락 기억</span>
            </div>
            <div class="feature">
              <span class="feature-icon">💾</span>
              <span>장기 기억</span>
            </div>
          </div>
        </div>
      </div>

      <div class="chat-input-container">
        <div class="thinking-indicator" id="thinkingIndicator" style="display: none;">
          <div class="thinking-dots">
            <div class="thinking-dot"></div>
            <div class="thinking-dot"></div>
            <div class="thinking-dot"></div>
          </div>
          <div class="thinking-content">
            <span id="thinkingText">생각하는 중...</span>
            <span id="thinkingSubtext" style="display: none; font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;"></span>
            <div class="thinking-progress" id="thinkingProgress" style="display: none;">
              <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
              </div>
            </div>
          </div>
        </div>

        <form class="chat-input-form" id="chatForm">
          <textarea
            id="messageInput"
            placeholder="메시지를 입력하세요... (Shift+Enter로 줄바꿈, Ctrl+/로 단축키 보기)"
            rows="1"
          ></textarea>
          <div class="input-actions">
            <button type="button" class="voice-btn" id="voiceInputBtn" title="음성 입력">
              <span id="voiceIcon">🎤</span>
            </button>
            <button type="submit" class="send-btn" id="sendBtn">
              <span>➤</span>
            </button>
          </div>
        </form>
      </div>
    </main>
  </div>

  <!-- 모달들 -->
  <!-- 장기 기억 모달 -->
  <div class="modal" id="memoryModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>📚 장기 기억 관리</h3>
        <button class="close-btn" data-modal="memoryModal">×</button>
      </div>
      <div class="modal-body">
        <div class="memory-settings" style="margin-bottom: 1rem; padding: 1rem; background: var(--surface); border-radius: 8px;">
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
            <input type="checkbox" id="memoryAutoExtractToggle" checked style="width: 18px; height: 18px;">
            <span>자동 장기 기억 추출 활성화</span>
          </label>
          <p style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">
            AI가 대화에서 중요한 정보를 자동으로 감지하여 장기 기억으로 저장할지 제안합니다.
          </p>
        </div>
        <div class="memory-actions">
          <button class="btn btn-primary" id="addMemoryBtn">새 기억 추가</button>
          <input type="text" id="memorySearchInput" placeholder="기억 검색...">
        </div>
        <div class="memories-list" id="memoriesList">
          <!-- 장기 기억 목록 -->
        </div>
      </div>
    </div>
  </div>

  <!-- 의사결정 로그 모달 -->
  <div class="modal" id="decisionLogModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>🧠 사고 과정</h3>
        <button class="close-btn" data-modal="decisionLogModal">×</button>
      </div>
      <div class="modal-body">
        <div id="decisionLogContent">
          <!-- 의사결정 로그 내용 -->
        </div>
      </div>
    </div>
  </div>

  <!-- Debate 모드 세부 의견 모달 -->
  <div class="modal" id="debateModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>💬 각 AI의 의견</h3>
        <button class="close-btn" data-modal="debateModal">×</button>
      </div>
      <div class="modal-body">
        <div id="debateContent">
          <!-- Debate 내용 -->
        </div>
      </div>
    </div>
  </div>

  <!-- Voting 모드 투표 결과 모달 -->
  <div class="modal" id="votingModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>🗳️ 투표 결과</h3>
        <button class="close-btn" data-modal="votingModal">×</button>
      </div>
      <div class="modal-body">
        <div id="votingContent">
          <!-- Voting 내용 -->
        </div>
      </div>
    </div>
  </div>

  <!-- 성능 대시보드 모달 -->
  <div class="modal" id="performanceModal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3>📊 성능 대시보드</h3>
        <button class="close-btn" data-modal="performanceModal">×</button>
      </div>
      <div class="modal-body">
        <div id="performanceContent">
          <!-- 성능 통계 내용 -->
        </div>
      </div>
    </div>
  </div>

  <!-- 학습 결과 시각화 모달 -->
  <div class="modal" id="learningModal" style="display: none;">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h3>📈 학습 결과 시각화</h3>
        <button class="close-btn" data-modal="learningModal">×</button>
      </div>
      <div class="modal-body">
        <div id="learningContent">
          <!-- 학습 결과 내용 -->
        </div>
      </div>
    </div>
  </div>

  <!-- 플러그인 관리 모달 -->
  <div class="modal" id="pluginsModal" style="display: none;">
    <div class="modal-content" style="max-width: 700px;">
      <div class="modal-header">
        <h3>🔌 플러그인 관리</h3>
        <button class="close-btn" data-modal="pluginsModal">×</button>
      </div>
      <div class="modal-body">
        <div id="pluginsContent">
          <!-- 플러그인 목록 내용 -->
        </div>
      </div>
    </div>
  </div>

  <!-- 프로젝트 관리 모달 -->
  <div class="modal" id="projectModal" style="display: none;">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h3>📁 프로젝트 관리</h3>
        <button class="close-btn" data-modal="projectModal">×</button>
      </div>
      <div class="modal-body">
        <div class="project-actions" style="margin-bottom: 1rem;">
          <button class="btn btn-primary" id="createProjectBtn">새 프로젝트 생성</button>
        </div>
        <div id="projectsList">
          <!-- 프로젝트 목록 -->
        </div>
      </div>
    </div>
  </div>

  <!-- 프로젝트 상세 모달 -->
  <div class="modal" id="projectDetailModal" style="display: none;">
    <div class="modal-content" style="max-width: 1000px; max-height: 90vh;">
      <div class="modal-header">
        <h3 id="projectDetailTitle">📁 프로젝트 상세</h3>
        <button class="close-btn" data-modal="projectDetailModal">×</button>
      </div>
      <div class="modal-body">
        <div id="projectDetailContent">
          <!-- 프로젝트 상세 내용 -->
        </div>
      </div>
    </div>
  </div>

  <!-- 웹 브라우저 제어 모달 -->
  <div class="modal" id="browserControlModal" style="display: none;">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h3>🌐 웹 브라우저 제어</h3>
        <button class="close-btn" data-modal="browserControlModal">×</button>
      </div>
      <div class="modal-body">
        <div class="browser-control-content">
          <div class="browser-control-input">
            <input type="text" id="browserUrlInput" placeholder="URL을 입력하세요 (예: https://example.com)" class="browser-url-input">
            <button class="btn btn-primary" id="browserNavigateBtn">탐색</button>
            <button class="btn btn-secondary" id="browserScreenshotBtn">스크린샷</button>
            <button class="btn btn-secondary" id="browserCloseBtn">닫기</button>
          </div>
          <div class="browser-preview" id="browserPreview">
            <div class="browser-preview-placeholder">
              <p>웹 페이지를 탐색하면 여기에 스크린샷이 표시됩니다.</p>
              <p class="browser-hint">💡 팁: AI에게 "https://example.com으로 이동해줘" 또는 "구글에서 검색해줘"라고 요청하면 자동으로 브라우저를 제어합니다.</p>
            </div>
          </div>
          <div class="browser-control-actions">
            <h4>빠른 작업</h4>
            <div class="browser-quick-actions">
              <button class="btn btn-outline" onclick="sendBrowserCommand('navigate', 'https://www.google.com')">구글 열기</button>
              <button class="btn btn-outline" onclick="sendBrowserCommand('screenshot')">스크린샷 찍기</button>
              <button class="btn btn-outline" onclick="sendBrowserCommand('getContent')">페이지 내용 가져오기</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 음성 설정 모달 -->
  <div class="modal" id="voiceSettingsModal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3>🎙️ 음성 설정</h3>
        <button class="close-btn" data-modal="voiceSettingsModal">×</button>
      </div>
      <div class="modal-body">
        <div class="voice-settings-content">
          <!-- 언어 설정 -->
          <div class="setting-group">
            <label for="voiceLanguage">언어</label>
            <select id="voiceLanguage" class="setting-select">
              <option value="ko-KR">한국어</option>
              <option value="en-US">English (US)</option>
              <option value="en-GB">English (UK)</option>
              <option value="ja-JP">日本語</option>
              <option value="zh-CN">中文 (简体)</option>
              <option value="zh-TW">中文 (繁體)</option>
              <option value="es-ES">Español</option>
              <option value="fr-FR">Français</option>
              <option value="de-DE">Deutsch</option>
            </select>
          </div>

          <!-- 목소리 선택 -->
          <div class="setting-group">
            <label for="voiceName">목소리</label>
            <select id="voiceName" class="setting-select">
              <option value="">기본 목소리</option>
            </select>
          </div>

          <!-- 속도 조절 -->
          <div class="setting-group">
            <label for="voiceRate">
              속도: <span id="rateValue">1.0</span>x
            </label>
            <input type="range" id="voiceRate" min="0.5" max="2.0" step="0.1" value="1.0" class="setting-slider">
          </div>

          <!-- 음높이 조절 -->
          <div class="setting-group">
            <label for="voicePitch">
              음높이: <span id="pitchValue">1.0</span>
            </label>
            <input type="range" id="voicePitch" min="0.5" max="2.0" step="0.1" value="1.0" class="setting-slider">
          </div>

          <!-- 볼륨 조절 -->
          <div class="setting-group">
            <label for="voiceVolume">
              볼륨: <span id="volumeValue">100</span>%
            </label>
            <input type="range" id="voiceVolume" min="0" max="100" step="1" value="100" class="setting-slider">
          </div>

          <!-- 테스트 버튼 -->
          <div class="setting-group">
            <button class="btn btn-secondary" id="testVoiceBtn">음성 테스트</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/app.js"></script>
  <script>
    // Service Worker 등록
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then((registration) => {
            console.log('Service Worker 등록 성공:', registration.scope);
            
            // 업데이트 확인
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // 새 버전 사용 가능 알림 (선택사항)
                  console.log('새 버전이 사용 가능합니다.');
                }
              });
            });
          })
          .catch((error) => {
            console.log('Service Worker 등록 실패:', error);
          });
      });
    }

    // PWA 설치 프롬프트 처리
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      // 설치 버튼 표시 (선택사항)
      console.log('PWA 설치 가능');
    });
  </script>
